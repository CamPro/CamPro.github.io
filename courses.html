<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Trèo Tường Vào Trường</title>
	<link rel="stylesheet" href="./public/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="./public/plugins/sweetalert2/sweetalert2.min.css">
	<link rel="stylesheet" href="./public/css/adminlte.min.css">
	<link rel="stylesheet" href="./public/css/mystyle.css">
</head>

<body class="hold-transition sidebar-mini layout-navbar-fixed layout-fixed">

	<div class="wrapper">

		<nav class="main-header navbar navbar-expand border-bottom-0 text-sm navbar-light" id="header">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>
				<li class="nav-item d-none d-sm-inline-block">
					<a href="./" class="nav-link"><i class="fas fa-home"></i></a>
				</li>
			</ul>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<a href="/calendar.html" class="nav-link" id="my-clock"><i class="far fa-clock"></i></a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-comments"></i>
						<span class="badge badge-danger navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-bell"></i>
						<span class="badge badge-warning navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
						<i class="fas fa-th-large"></i>
					</a>
				</li>
			</ul>
		</nav>

		<aside class="main-sidebar sidebar-dark-primary elevation-4">
			<a href="./" class="brand-link text-md">
				<img src="https://graph.facebook.com/100007543845219/picture?height=100&width=100&access_token=6628568379%7Cc1e620fa708a1d5696fb991c1bde5662" class="brand-image img-circle elevation-3">
				<span class="brand-text font-weight-light" id="hello-user">MY LEARN</span>
			</a>
			<div class="sidebar">
				<div class="form-inline">
					<div class="input-group" data-widget="sidebar-search">
						<input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
						<div class="input-group-append">
							<button class="btn btn-sidebar">
								<i class="fas fa-search fa-fw"></i>
							</button>
						</div>
					</div>
					<div class="sidebar-search-results">
						<div class="list-group">
						</div>
					</div>
				</div>
				<nav class="mt-2 text-sm">
					<ul class="nav nav-pills nav-sidebar flex-column nav-child-indent" data-widget="treeview" role="menu" data-accordion="false">
						<li class="nav-item">
							<a href="/home.html" class="nav-link ">
								<i class="nav-icon fas fa-tachometer-alt"></i><p>Ngôi Nhà Vĩ Nhân</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/calendar.html" class="nav-link ">
								<i class="nav-icon fas fa-calendar-alt"></i><p>Lịch Treo Tường <i class="fas fa-star right text-warning"></i></p>
							</a>
						</li>
						<li class="nav-header text-warning">6. Áp dụng kiến thức</li>
						<li class="nav-item">
							<a href="/libraries.html" class="nav-link ">
								<i class="nav-icon fas fa-skating"></i><p>Thư Viện Cuộc Sống</p>
							</a>
						</li>
						<li class="nav-header text-warning">5. Tổng hợp kiến thức</li>
						<li class="nav-item">
							<a href="/knowledge.html" class="nav-link ">
								<i class="nav-icon fas fa-sitemap"></i><p>Xây Thành Đắp Lũy</p>
							</a>
						</li>
						<li class="nav-header text-warning">4. Phân tích thông tin</li>
						<li class="nav-item">
							<a href="/learning.html" class="nav-link ">
								<i class="nav-icon fas fa-rocket"></i><p>Tiêu Hóa Thông Tin</p>
							</a>
						</li>
						<li class="nav-header text-warning">3. Tóm tắt thông tin</li>
						<li class="nav-item">
							<a href="/classroom.html" class="nav-link ">
								<i class="nav-icon fas fa-chalkboard-teacher"></i><p>Lớp Học Quái Vật</p>
							</a>
						</li>
						<li class="nav-header text-warning">2. Tổ chức dữ liệu</li>
						<li class="nav-item">
							<a href="/courses.html" class="nav-link active">
								<i class="nav-icon fas fa-cubes"></i><p>Trèo Tường Vào Trường</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/posts.html" class="nav-link ">
								<i class="nav-icon fas fa-cloud-sun"></i><p>Kho Tàng Tri Thức</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/booking.html" class="nav-link ">
								<i class="nav-icon fas fa-book"></i><p>Từ Sách Đến Đời</p>
							</a>
						</li>
						<li class="nav-header text-warning">1. Thu thập dữ liệu</li>
						<li class="nav-item">
							<a href="/timeline.html" class="nav-link ">
								<i class="nav-icon fas fa-pencil-alt"></i><p>Nhật Ký Ý Tưởng</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/crawler.html" class="nav-link ">
								<i class="nav-icon fas fa-leaf"></i><p>Duyệt Kinh Điển</p>
							</a>
						</li>
						<li class="nav-header">------------------</li>
						<li class="nav-item">
							<a href="/backup.html" class="nav-link ">
								<i class="nav-icon fas fa-dove"></i><p>Trường Sinh Bất Lão</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/signin.html" class="nav-link">
								<i class="nav-icon fas fa-sign-in-alt"></i><p>Đăng Nhập</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="#" class="nav-link" id="sign-out">
								<i class="nav-icon fas fa-sign-out-alt"></i><p>Đăng Xuất</p>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</aside>

		<aside class="control-sidebar control-sidebar-dark">
			<div class="p-3">
				<h5>Thanh Công Cụ</h5>
				<div class="mb-4"><input type="checkbox" id="dark-mode" class="mr-1"><span>Dark Mode</span></div>
				
				<button class="btn btn-sm btn-default" id="fast-highlight"><span class="badge bg-success" id="fast-number"></span> <i class="fas fa-spell-check"></i> highlight</button>
				<textarea class="form-control" id="fast-content" rows="8"></textarea>
				<select class="form-control" id="fast-categories">
				</select>
				<select class="form-control" id="fast-courses">
				</select>
				<button class="btn btn-sm btn-primary" id="fast-knowledge"><i class="fas fa-edit"></i> Kiến Tạo</button>
			</div>
		</aside>

		<div class="content-wrapper">
			<div class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1 class="m-0"></h1>
						</div>
					</div>
				</div>
			</div>
			<div class="content">
				<div class="container-fluid" id="page-box">

					<div class="row">
						<div class="col-sm-4 table-responsive">
							<table class="table table-hover table-bordered text-nowrap">
								<thead>
									<tr>
										<th>
											Lĩnh Vực/Chủ Đề
											<button class="btn btn-default btn-xs" id="category-sort"><i class="fas fa-sort-amount-up-alt"></i></button>
											<button class="btn btn-primary btn-xs float-right" id="category-create"><i class="fas fa-plus"></i></button>
										</th>
									</tr>
								</thead>
								<tbody id="room-categories">
								</tbody>
							</table>
						</div>
						<div class="col-sm-8 table-responsive">
							<table class="table table-hover table-bordered text-nowrap">
								<thead>
									<tr>
										<th>
											Khóa học
											<button class="btn btn-default btn-xs" id="course-sort"><i class="fas fa-sort-amount-up-alt"></i></button>
											<button class="btn btn-primary btn-xs float-right" id="course-create"><i class="fas fa-plus"></i></button>
											<button class="btn btn-default btn-xs float-right" id="lesson-modal"><i class="fas fa-vector-square"></i></button>
										</th>
									</tr>
								</thead>
								<tbody id="room-courses">
								</tbody>
							</table>
						</div>
					</div>

				</div>
			</div>
		</div>

		<footer class="main-footer">
			<div class="text-center">** Cắp sách đi học Trường Đời - Cố thêm 1 Chút thôi - Thừa hơn Thiếu **</div>
		</footer>
		<div class="modal fade" id="modal-overlay">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title"></h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body-">
						<table class="table table-hover table-bordered table-sm">
							<thead>
								<tr>
									<th>
										<button class="btn btn-default btn-xs" id="lesson-sort"><i class="fas fa-sort-amount-up-alt"></i></button>
										<button class="btn btn-success btn-xs" id="lesson-save">Lưu danh sách</button>
										<small id="lesson-percent"></small>
										<button class="btn btn-default btn-xs text-info" id="lesson-upload"><i class="fas fa-cloud-upload-alt"></i></button>
										<button class="btn btn-primary btn-xs float-right" id="lesson-create"><i class="fas fa-plus"></i></button>

										<div class="input-group d-none">
											<div class="custom-file">
												<input type="file" class="custom-file-input" id="courseFileUpload">
												<label class="custom-file-label" for="courseFileUpload">Chọn ảnh</label>
											</div>
											<div class="input-group-append">
												<span class="btn btn-primary input-group-text" id="buttonFileUpload">Tải lên</span>
											</div>
										</div>
									</th>
								</tr>
							</thead>
							<tbody id="room-lessons">
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div id="back-to-top" onclick="backToTop()"><i class="fa fa-chevron-up"></i></div>
	<script src="./public/plugins/jquery/jquery.min.js"></script>
	<script src="./public/plugins/jquery-ui/jquery-ui.min.js"></script>
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-storage.js"></script>
	<script src="./public/plugins/moment/moment.min.js"></script>
	<script src="./public/plugins/sweetalert2/sweetalert2.min.js"></script>
	<script src="./public/plugins/bootstrap/bootstrap.bundle.min.js"></script>
	<script src="./public/plugins/bs-custom-file-input/bs-custom-file-input.min.js"></script>
	<script src="./public/js/adminlte.min.js"></script>
	<script src="./public/js/myfirebase.js"></script>
	<script src="./public/js/myscript.js"></script>
	<script type="text/javascript">

		var category_id = null;
		var course_id = null;
		var lesson_id = null;
		var timer = null;
		var file = null;

		$('#lesson-save').hide();
		$('#lesson-create').hide();
		$('#course-create').hide();
		// lấy danh sách lĩnh vực
		GetCategories();

		bsCustomFileInput.init();

		// thêm 1 lĩnh vực
		$('#category-create').click(function ()
		{
			clearTimeout(timer);
			let number = $("#room-categories tr").length + 1;

			let code = '<tr><td><div class="row">';
			code += '<div class="col-sm-10"><input type="text" class="form-control" placeholder="Tên lĩnh vực ' + number + '"></div>';
			code += '<div class="col-sm-2"><button class="btn btn-success" onclick="SaveCategory(this)">Lưu</button></div>';
			'</div></td></tr>';

			$('#room-categories').append(code);
			$('#category-create').html(number);

			timer = setTimeout(function ()
			{
				$('#category-create').html('<i class="fas fa-plus"></i>');
			}, 1000);
		});
		// xap sep
		$('#category-sort').click(function ()
		{
			$("#room-categories").sortable({
				// cập nhật số thứ tự
				update: function(event, ui)
				{
					let lists = $("#room-categories" ).sortable("toArray");
					for (var i = 0; i < lists.length; i++)
					{
						category_id = lists[i];
						fsdb.collection("categories").doc(category_id).update({
							index: (i + 1)
						})
						.then(() => {}).catch((error) => {
							console.log(error);
						});
					}
				}
			}).disableSelection();
		})
		// lưu 1 lĩnh vực mới
		function SaveCategory(element)
		{
			let category = $(element).parents('div.row').find('input').val().trim();

			let created_at = moment().unix();

			fsdb.collection("categories").add({
				index: 0,
				number_course: 0,
				category: category,
				created_at: created_at
			})
			.then((docRef) => {
				GetCategories();
			})
			.catch((error) => {
				console.log(error);
			});
		}
		// thêm 1 khóa học
		$('#course-create').click(function ()
		{
			clearTimeout(timer);
			let number = $("#room-courses tr").length + 1;

			let code = '<tr><td><div class="row">';
			code += '<div class="col-sm-10"><input type="text" class="form-control" placeholder="Khóa học ' + number + '"></div>';
			code += '<div class="col-sm-2"><button class="btn btn-success" onclick="SaveCourse(this)">Lưu</button></div>';
			'</div></td></tr>';

			$('#room-courses').append(code);
			$('#course-create').html(number);

			timer = setTimeout(function ()
			{
				$('#course-create').html('<i class="fas fa-plus"></i>');
			}, 1000);
		})
		// xap sep
		$('#course-sort').click(function ()
		{
			// drag drop
			$("#room-courses").sortable({
				// cập nhật số thứ tự
				update: function(event, ui)
				{
					let lists = $("#room-courses" ).sortable("toArray");
					for (var i = 0; i < lists.length; i++)
					{
						course_id = lists[i];
						fsdb.collection("courses").doc(course_id).update({
							index: (i + 1)
						})
						.then(() => {}).catch((error) => {
							console.log(error);
						});
					}
				}
			}).disableSelection();
		})
		// lưu 1 khóa học mới
		function SaveCourse(element)
		{
			let course = $(element).parents('div.row').find('input').val().trim();

			if (!category_id)
			{
				alert('category id is null');
				return;
			}
			let created_at = moment().unix();

			fsdb.collection("courses").add({
				index: 0,
				course: course,
				category_id: category_id,
				created_at: created_at,
				number_lesson: 0,
				number_done: 0
			})
			.then((docRef) => {
				GetCourses(category_id);
			})
			.catch((error) => {
				console.log(error);
			});
		}
		// tạo ô thêm thông tin 1 bài học
		$('#lesson-create').click(function ()
		{
			clearTimeout(timer);
			let number = $("#room-lessons tr").length + 1;

			let code = '<tr><td><div class="row">';
			code += '<div class="col-sm-6"><input type="text" class="form-control" placeholder="Tiêu đề ' + number + '"></div>';
			code += '<div class="col-sm-6"><textarea class="form-control" rows="1" onkeyup="HtmlChange(this)" placeholder="html ' + number + '"></textarea></div>';
			'</div></td></tr>';

			$('#room-lessons').append(code);
			$('#lesson-save').show();
			$('#lesson-create').html(number);

			timer = setTimeout(function ()
			{
				$('#lesson-create').html('<i class="fas fa-plus"></i>');
			}, 1000);
		})
		// xap sep
		$('#lesson-sort').click(function ()
		{
			// drag drop
			$("#room-lessons").sortable({
				// cập nhật số thứ tự
				update: function(event, ui)
				{
					let lists = $("#room-lessons" ).sortable("toArray");
					for (var i = 0; i < lists.length; i++)
					{
						lesson_id = lists[i];
						fsdb.collection("lessons").doc(lesson_id).update({
							index: (i + 1)
						})
						.then(() => {}).catch((error) => {
							console.log(error);
						});
					}
				}
			}).disableSelection();
		})
		// lưu danh sách bài học theo khóa học
		$('#lesson-save').click(function ()
		{
			if (!course_id) return;

			let elements = document.querySelectorAll('#room-lessons div.row');
			let loop = 0;
			let index = $("#room-lessons tr[id]").length;

			let interval = setInterval(function ()
			{
				let element = elements[loop];
				let lesson = $(element).find('input').val().trim();
				let content = $(element).find('textarea').val().trim();
				let created_at = moment().unix();

				if (!lesson)
				{
					$(element).find('input').addClass('is-invalid');
					return;
				}
				if (!content)
				{
					$(element).find('textarea').addClass('is-invalid');
					return;
				}
				
				fsdb.collection("lessons").add({
					index: ++index,
					content: content,
					course_id: course_id,
					lesson: lesson,
					created_at: created_at
				})
				.then((docRef) => {
					$(element).find('input').addClass('is-valid');
					$(element).find('textarea').addClass('is-valid');
				})
				.catch((error) => {
					console.log(error);
					$(element).find('input').addClass('is-invalid');
					$(element).find('textarea').addClass('is-invalid');
				});

				if (++loop >= elements.length)
				{
					clearInterval(interval);
				}
			}, 10);
		});

		$('#lesson-modal').click(function ()
		{
			$('#modal-overlay').modal('show');
		});

		$('#lesson-upload').click(function ()
		{
			$(this).hide();
			$('#courseFileUpload').parents('div.input-group').removeClass('d-none');
			document.getElementById('courseFileUpload').click();
		})

		$('#courseFileUpload').change(function (e)
		{
			file = e.target.files[0];
		})

		$('#buttonFileUpload').click(function ()
		{
			var extension = file.type;
			console.log(extension);
			extension = file.name.split('.').pop();

			var storageRef = firebase.storage().ref().child('simple_mind_courses/' + course_id);
			storageRef.put(file).then((snapshot) =>
			{
				$('#courseFileUpload').parents('div.input-group').addClass('d-none');
				$('#lesson-upload').show();
			});
		})

		function HtmlChange(element)
		{
			let content = $(element).val().replace(/width="(\w+.)"/, 'width="100%"').replace(/height="(\w+.)"/, 'height="100%"');
			$(element).val(content);
		}
		// lấy danh sách lĩnh vực
		function GetCategories()
		{
			$('#course-create').hide();
			$('#category-sort').html('<i class="fas fa-spinner fa-spin"></i>');
			fsdb.collection("categories").orderBy("index", "asc").get()
			.then((querySnapshot) => {
				let code = '';
				querySnapshot.forEach((doc) => {
					let docid = doc.id;
					let docdata = doc.data();
					code += '<tr id="' + docid + '"><td onclick="GetCourses(\'' + docid + '\')"><i class="fas fa-cube"></i> <span class="text">' + docdata.category + '</span><small class="float-right"><span class="progress-number">' + docdata.number_course + '</span> <span onclick="EditCategory(this)"><i class="fas fa-edit"></i></span> <span onclick="DeleteCategory(this)"><i class="fas fa-trash-alt text-gray"></i></span></small></td></tr>';
				});
				$('#room-categories').html(code);
				$('#category-sort').html('<i class="fas fa-sort-amount-up-alt"></i>');
			})
			.catch((error) => {
				console.log(error);
				$('#room-categories').html('<i class="fas fa-exclamation-triangle"></i>');
				$('#category-sort').html('<i class="fas fa-sort-amount-up-alt"></i>');
			});
		}
		// lấy danh dách toàn bộ khóa học
		function GetCourses(docid)
		{
			category_id = docid;
			$('#course-sort').html('<i class="fas fa-spinner fa-spin"></i>');
			$('#room-categories tr').css('background-color', '');
			$('#room-categories tr#' + category_id).css('background-color', 'gold');

			fsdb.collection("courses").where('category_id', '==', category_id).orderBy("index", "asc").get()
			.then((querySnapshot) => {
				let code = '';
				let number = 0;
				querySnapshot.forEach((doc) => {
					let docid = doc.id;
					let docdata = doc.data();

					let done = docdata.number_done;
					let total = docdata.number_lesson;

					let persent = Math.ceil(done * 100 / total) || 0;

					code += '<tr id="' + docid + '"><td onclick="GetLessons(\'' + docid + '\')" data-toggle="modal" data-target="#modal-overlay"><div class="progress-group progress-xs">';
					code += '<span class="progress-text"><i class="fas fa-book"></i> <span class="text">' + docdata.course + '</span></span>';
					code += '<small class="float-right"><span class="progress-number">' + done + '/' + total + '</span> <span onclick="EditCourse(this)"><i class="fas fa-edit"></i></span> <span onclick="DeleteCourse(this)"><i class="fas fa-trash-alt text-gray"></i></span></small>';
					code += '<div class="progress progress-xs">';
					code += '<div class="progress-bar bg-success" style="width: ' + persent + '%"></div>';
					code += '</div></div></td></tr>';

					++number;
				});
				$('#room-courses').html(code);

				$('#room-categories tr#' + category_id + ' span.progress-number').text(number);
				$('#course-sort').html('<i class="fas fa-sort-amount-up-alt"></i>');

				// cập nhật chỉ số chủ đề
				fsdb.collection("categories").doc(category_id).update({
					number_course: number
				})
				.catch((error) => {
					console.log(error);
				});
			})
			.catch((error) => {
				console.log(error);
				$('#room-courses').html('<i class="fas fa-exclamation-triangle"></i>');
				$('#course-sort').html('<i class="fas fa-sort-amount-up-alt"></i>');
			});
			$('#room-lessons').html('');
			$('#lesson-create').hide();
			$('#lesson-save').hide();
			$('#course-create').show();
		}
		// lấy danh sách bài học theo khóa học
		function GetLessons(docid)
		{
			course_id = docid;
			$('#lesson-sort').html('<i class="fas fa-spinner fa-spin"></i>');
			$('#room-courses tr').css('background-color', '');
			$('#room-courses tr#' + course_id).css('background-color', 'gold');
			let course = $('tr#' + course_id).find('span.text').text();
			$('#modal-overlay .modal-title').text(course);

			fsdb.collection("lessons").where('course_id', '==', course_id).orderBy("index", "asc").get()
			.then((querySnapshot) => {
				let total = 0;
				let done = 0;
				let code = '<tr><td class="d-none"><img src="" class="img-fluid" id="course-picture"></td></tr>';
				querySnapshot.forEach((doc) => {
					let docid = doc.id;
					let docdata = doc.data();
					let completed = docdata.completed && docdata.completed == true;

					++total;
					if (completed) ++done;

					let link = '/classroom.html?lesson=' + docid + '&slug=' + TextToSlug(doc.data().lesson);

					code += '<tr id="' + docid + '"><td><div class="float-left"><a class="' + (completed ? 'text-gray' : '') + '" href="' + link + '">' + (completed ? '<i class="fas fa-user-graduate text-success"></i>' : '<i class="fas fa-hiking"></i>') + ' <span class="text">' + docdata.lesson + '</span></a></div><small class="float-right"><span onclick="EditLesson(this)"><i class="fas fa-edit"></i></span> <span onclick="DeleteLesson(this)"><i class="fas fa-trash-alt text-gray"></i></span></small></td></tr>';
				});
				$('#room-lessons').html(code);
				// cập nhật chỉ số
				let persent = Math.ceil(done * 100 / total) || 0;
				$('tr#' + course_id).find('.progress-number').html(persent + '%');
				$('tr#' + course_id).find('.progress-bar').attr('style', 'width: ' + persent + '%');
				$('#lesson-sort').html('<i class="fas fa-sort-amount-up-alt"></i>');
				$('#lesson-percent').text(done + '/' + total);


				// cập nhật chỉ số khóa học
				fsdb.collection("courses").doc(course_id).update({
					number_lesson: total,
					number_done: done
				})
				.catch((error) => {
					console.log(error);
				});
				// lấy hình ảnh mindmap nếu có
				var storageRef = firebase.storage().ref();
				storageRef.child('simple_mind_courses/' + course_id).getDownloadURL().then((url) => {
					$('#course-picture').attr('src', url);
					$('#course-picture').parent().removeClass('d-none');
				})
				.catch((error) => {
					console.log(error);
				});

			})
			.catch((error) => {
				console.log(error);
				$('#room-lessons').html('<i class="fas fa-exclamation-triangle"></i>');
				$('#lesson-sort').html('<i class="fas fa-sort-amount-up-alt"></i>');
			});
			$('#lesson-create').show();
		}
		// xóa 1 khóa học
		function DeleteCourse(element)
		{
			if (!confirm('Xóa khóa học?'))
			{
				return;
			}
			course_id = $(element).parents('tr').attr('id');

			fsdb.collection("courses").doc(course_id).delete().then(() => {
				GetCourses(category_id);
			}).catch((error) => {
				console.log(error);
			});
		}
		// xóa 1 chủ đề
		function DeleteCategory(element)
		{
			if (!confirm('Xóa chủ đề?'))
			{
				return;
			}
			category_id = $(element).parents('tr').attr('id');
			fsdb.collection("categories").doc(category_id).delete().then(() => {
				GetCategories();
			}).catch((error) => {
				console.log(error);
			});
		}
		// xóa 1 bài học
		function DeleteLesson(element)
		{
			if (!confirm('Xóa bài học?'))
			{
				return;
			}
			lesson_id = $(element).parents('tr').attr('id');
			fsdb.collection("lessons").doc(lesson_id).delete().then(() => {
				GetLessons(course_id);
			}).catch((error) => {
				console.log(error);
			});
		}
		// sửa tên 1 chủ đề
		function EditCategory(element)
		{
			category_id = $(element).parents('tr').attr('id');
			let title = $('#room-categories tr#' + category_id + ' span.text').text();

			title = prompt('Nhập tên mới', title);
			if (!title)
			{
				return;
			}
			fsdb.collection("categories").doc(category_id).update({
				category: title
			})
			.then(() => {
				$('#room-categories tr#' + category_id + ' span.text').text(title);
			}).catch((error) => {
				console.log(error);
			});
		}
		// sửa tên 1 khóa học
		function EditCourse(element)
		{
			course_id = $(element).parents('tr').attr('id');
			let title = $('#room-courses tr#' + course_id + ' span.text').text();

			title = prompt('Nhập tên mới', title);
			if (!title)
			{
				return;
			}
			fsdb.collection("courses").doc(course_id).update({
				course: title
			})
			.then(() => {
				$('#room-courses tr#' + course_id + ' span.text').text(title);
			}).catch((error) => {
				console.log(error);
			});
		}
		// sửa tên 1 bài học
		function EditLesson(element)
		{
			lesson_id = $(element).parents('tr').attr('id');
			let title = $('#room-lessons tr#' + lesson_id + ' span.text').text();

			title = prompt('Nhập tên mới', title);
			if (!title)
			{
				return;
			}
			fsdb.collection("lessons").doc(lesson_id).update({
				lesson: title
			})
			.then(() => {
				$('#room-lessons tr#' + lesson_id + ' span.text').text(title);
			}).catch((error) => {
				console.log(error);
			});
		}

	</script>
</body>
</html>