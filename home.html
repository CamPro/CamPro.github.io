<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ngôi Nhà Vĩ Nhân</title>
	<link rel="stylesheet" href="./public/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="./public/plugins/sweetalert2/sweetalert2.min.css">
	<link rel="stylesheet" href="./public/css/carousel.css">
	<link rel="stylesheet" href="./public/css/adminlte.min.css">
	<link rel="stylesheet" href="./public/css/mystyle.css">
</head>

<body class="hold-transition sidebar-mini layout-navbar-fixed layout-fixed">
	<div class="wrapper">

		<nav class="main-header navbar navbar-expand border-bottom-0 text-sm navbar-light" id="header">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>
				<li class="nav-item d-none d-sm-inline-block">
					<a href="./" class="nav-link"><i class="fas fa-home"></i></a>
				</li>
			</ul>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<span class="nav-link" id="my-clock" onclick="myClock()"><i class="far fa-clock"></i></span>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-comments"></i>
						<span class="badge badge-danger navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-bell"></i>
						<span class="badge badge-warning navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
						<i class="fas fa-th-large"></i>
					</a>
				</li>
			</ul>
		</nav>

		<aside class="main-sidebar sidebar-dark-primary elevation-4">
			<a href="./" class="brand-link text-md">
				<img src="https://graph.facebook.com/100007543845219/picture?height=100&width=100&access_token=6628568379%7Cc1e620fa708a1d5696fb991c1bde5662" class="brand-image img-circle elevation-3">
				<span class="brand-text font-weight-light" id="hello-user">MY LEARN</span>
			</a>
			<div class="sidebar">
				<div class="form-inline">
					<div class="input-group" data-widget="sidebar-search">
						<input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
						<div class="input-group-append">
							<button class="btn btn-sidebar">
								<i class="fas fa-search fa-fw"></i>
							</button>
						</div>
					</div>
					<div class="sidebar-search-results">
						<div class="list-group">
						</div>
					</div>
				</div>
				<nav class="mt-2 text-sm">
					<ul class="nav nav-pills nav-sidebar flex-column nav-child-indent" data-widget="treeview" role="menu" data-accordion="false">
						<li class="nav-item">
							<a href="/home.html" class="nav-link ">
								<i class="nav-icon fas fa-tachometer-alt"></i><p>Ngôi Nhà Vĩ Nhân</p>
							</a>
						</li>
						<li class="nav-header text-warning">6. Áp dụng kiến thức</li>
						<li class="nav-header text-warning">5. Tổng hợp kiến thức</li>
						<li class="nav-header text-warning">4. Phân tích thông tin</li>
						<li class="nav-item">
							<a href="/learning.html" class="nav-link ">
								<i class="nav-icon fas fa-rocket"></i><p>Tiêu Hóa Thông Tin</p>
							</a>
						</li>
						<li class="nav-header text-warning">3. Tóm tắt thông tin</li>
						<li class="nav-item">
							<a href="/classroom.html" class="nav-link ">
								<i class="nav-icon fas fa-chalkboard-teacher"></i><p>Lớp Học Quái Vật</p>
							</a>
						</li>
						<li class="nav-header text-warning">2. Tổ chức dữ liệu</li>
						<li class="nav-item">
							<a href="/courses.html" class="nav-link ">
								<i class="nav-icon fas fa-cubes"></i><p>Trèo Tường Vào Trường</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/posts.html" class="nav-link ">
								<i class="nav-icon fas fa-cloud-sun"></i><p>Kho Tàng Tri Thức</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/booking.html" class="nav-link ">
								<i class="nav-icon fas fa-book"></i><p>Từ Sách Đến Đời</p>
							</a>
						</li>
						<li class="nav-header text-warning">1. Thu thập dữ liệu</li>
						<li class="nav-item">
							<a href="/timeline.html" class="nav-link ">
								<i class="nav-icon fas fa-pencil-alt"></i><p>Nhật Ký Ý Tưởng</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/crawler.html" class="nav-link ">
								<i class="nav-icon fas fa-leaf"></i><p>Duyệt Kinh Điển</p>
							</a>
						</li>
						<li class="nav-header">------------------</li>
						<li class="nav-item">
							<a href="/backup.html" class="nav-link ">
								<i class="nav-icon fas fa-dove"></i><p>Trường Sinh Bất Lão</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/signin.html" class="nav-link">
								<i class="nav-icon fas fa-sign-in-alt"></i><p>Đăng Nhập</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="#" class="nav-link" id="sign-out">
								<i class="nav-icon fas fa-sign-out-alt"></i><p>Đăng Xuất</p>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</aside>

		<aside class="control-sidebar control-sidebar-dark">
			<div class="p-3">
				<h5>Thanh Công Cụ</h5>
				<div class="mb-4"><input type="checkbox" id="dark-mode" class="mr-1"><span>Dark Mode</span></div>

				<button class="btn btn-sm btn-default" id="highlight-text"><span class="badge bg-success" id="number-knowledge"></span> <i class="fas fa-spell-check"></i> highlight text</button>
				<textarea class="form-control" id="text-to-knowledge" rows="8"></textarea>
				<input type="text" list="courses" class="form-control" name="create-course" id="create-course" placeholder="chọn khóa học">
				<datalist id="courses">
					<option value="Sức Khỏe"/>
					<option value="Sự Nghiệp"/>
					<option value="Gia Đình"/>
					<option value="Bạn Bè"/>
					<option value="Giao Tiếp"/>
					<option value="Con Gái">*</option>
					<option value="Tán Gái">*</option>
					<option value="Tìm Hiểu Nhàn">*</option>
					<option value="Cuộc Sống"/>
					<option value="Công Việc"/>
					<option value="Xã Hội"/>
					<option value="Tình Yêu"/>
					<option value="Phụ Nữ"/>
					<option value="Tiền Bạc/Tài Chính"/>
					<option value="Tư Duy"/>
					<option value="Khoa Học"/>
					<option value="Thời Gian"/>
					<option value="Con Người"/>
					<option value="Sách"/>
				</datalist>
				<input type="text" class="form-control" name="create-image" id="create-image" placeholder="url hình ảnh">
				<button class="btn btn-sm btn-primary" id="create-knowledge"><i class="fas fa-edit"></i> Kiến Tạo</button>
			</div>
		</aside>

		<div class="content-wrapper">
			<div class="content">
				<div id="myCarousel" class="carousel- slide" data-ride="carousel">
					<ol class="carousel-indicators">
						<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
						<li data-target="#myCarousel" data-slide-to="1"></li>
						<li data-target="#myCarousel" data-slide-to="2"></li>
					</ol>
					<div class="carousel-inner"> 
					</div>
					<a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev" style="display:none;">
						<span class="carousel-control-prev-icon" aria-hidden="true"></span>
						<span class="sr-only">Previous</span>
					</a>
					<a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next" style="display:none;">
						<span class="carousel-control-next-icon" aria-hidden="true"></span>
						<span class="sr-only">Next</span>
					</a>
				</div>
			</div>
			<div class="content">
				<div class="row">
					<div class="col-lg-7">
						<textarea class="form-control" rows="18" id="note-data-1" data-id="1"></textarea>
					</div>
					<div class="col-lg-5">
						<textarea class="form-control" rows="18" id="note-data-2" data-id="2"></textarea>
					</div>
				</div>
			</div>
			<div class="content">
				<div class="row">
					<div class="col-lg-6">
						<textarea class="form-control" rows="18" id="note-data-3" data-id="3"></textarea>
					</div>
					<div class="col-lg-6">
						<textarea class="form-control" rows="18" id="note-data-4" data-id="4"></textarea>
					</div>
				</div>
			</div>
			<div class="content">
				<textarea class="form-control" rows="18" id="note-data-5" data-id="5"></textarea>
			</div>
		</div>

		<footer class="main-footer">
			<div class="text-center multicolor">** Tinh Hoa Hội Tụ **</div>
		</footer>
	</div>
	<div id="back-to-top" onclick="backToTop()"><i class="fa fa-chevron-up"></i></div>
	<script src="./public/plugins/jquery/jquery.min.js"></script>
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
	<script src="./public/plugins/moment/moment.min.js"></script>
	<script src="./public/plugins/sweetalert2/sweetalert2.min.js"></script>
	<script src="./public/js/adminlte.min.js"></script>
	<script src="./public/js/myfirebase.js"></script>
	<script src="./public/js/myscript.js"></script>
	<script type="text/javascript">

		var timer = null;
		$('#note-data-1').keyup(function ()
		{
			clearTimeout(timer);
			timer = setTimeout(function () { NoteSave(1) }, 5000);
			AutoSize(this);
		});
		$('#note-data-2').keyup(function ()
		{
			clearTimeout(timer);
			timer = setTimeout(function () { NoteSave(2) }, 5000);
			AutoSize(this);
		});
		$('#note-data-3').keyup(function ()
		{
			clearTimeout(timer);
			timer = setTimeout(function () { NoteSave(3) }, 5000);
			AutoSize(this);
		});
		$('#note-data-4').keyup(function ()
		{
			clearTimeout(timer);
			timer = setTimeout(function () { NoteSave(4) }, 5000);
			AutoSize(this);
		});

		$('#note-data-5').keyup(function ()
		{
			clearTimeout(timer);
			timer = setTimeout(function () { NoteSave(5) }, 5000);
			AutoSize(this);
		});

		$('#note-data-1').change(function ()
		{
			clearTimeout(timer);
			NoteSave(1);
			AutoSize(this);
		});
		$('#note-data-2').change(function ()
		{
			clearTimeout(timer);
			NoteSave(2);
			AutoSize(this);
		});
		$('#note-data-3').change(function ()
		{
			clearTimeout(timer);
			NoteSave(3);
			AutoSize(this);
		});
		$('#note-data-4').change(function ()
		{
			clearTimeout(timer);
			NoteSave(4);
			AutoSize(this);
		});
		$('#note-data-5').change(function ()
		{
			clearTimeout(timer);
			NoteSave(5);
			AutoSize(this);
		});

		function NoteSave(noteid)
		{
			noteid = noteid.toString();

			let note = $('#note-data-'+noteid).val().trim();

			fsdb.collection("notes").doc(noteid).set({
				note: note
			})
			.then(() => {
				Toast.fire({ icon: 'success', title: 'Đã lưu note ' + noteid});
			})
			.catch((error) => {
				Toast.fire({ icon: 'error', title: error });
			});
		}


		let index = 0;

		/* get last index */
		fsdb.collection("posts").orderBy("index", "desc").limit(1).get()
		.then((querySnapshot) => {
			querySnapshot.forEach((doc) =>
			{
				let docdata = doc.data();
				index = docdata.index;
			});
			index = Math.floor(Math.random() * index); /* random 0-max */
			GetOnePost(index);
		})
		.catch((error) => {
			console.log(error);
		});

		function GetOnePost(idx)
		{
			console.log(idx);
			let active = true;

			var firstNew = fsdb.collection("posts").where("index", "==", idx).get()
			.then((querySnapshot) => {
				querySnapshot.forEach((doc) => {

					let docid = doc.id;
					let docdata = doc.data();

					let linkurl = '/post.html?source=' + docdata.source + '&slug=' + docdata.slug + '&docid=' + docid;

					let html = '<div class="carousel-item '+(active ? 'active' : '')+'">'
					html += '<img class="bd-placeholder-img" width="100%" height="100%" src="'+docdata.image+'">';
					html += '<div class="container">';
					html += '<div class="carousel-caption text-left">';
					html += '<h1 class="multicolor">'+docdata.title+'</h1>';
					html += '<p class="twocolor">'+docdata.creator+' ('+docdata.category+')</p>';
					html += '<p><a class="btn btn-lg btn-primary" href="'+linkurl+'">Kinh Điển ('+docdata.number_reads+')</a></p>';
					html += '</div>';
					html += '</div>';
					html += '</div>';
					$('.carousel-inner').append(html);
					active = false;

				});
			})
			.catch((error) => {
				console.log(error);
			});
		}

	</script>
	<script type="text/javascript">

		/* get note */
		fsdb.collection("notes").doc('1').get().then((doc) =>{
			if (doc.exists) {
				$('#note-data-1').val(doc.data().note);
				var element = document.querySelector('#note-data-1');
				AutoSize(element);
			}
		})

		/* get note */
		fsdb.collection("notes").doc('2').get().then((doc) =>{
			if (doc.exists) {
				$('#note-data-2').val(doc.data().note);
				var element = document.querySelector('#note-data-2');
				AutoSize(element);
			}
		})

		/* get note */
		fsdb.collection("notes").doc('3').get().then((doc) =>{
			if (doc.exists) {
				$('#note-data-3').val(doc.data().note);
				var element = document.querySelector('#note-data-3');
				AutoSize(element);
			}
		})

		/* get note */
		fsdb.collection("notes").doc('4').get().then((doc) =>{
			if (doc.exists) {
				$('#note-data-4').val(doc.data().note);
				var element = document.querySelector('#note-data-4');
				AutoSize(element);
			}
		})

		/* get note */
		fsdb.collection("notes").doc('5').get().then((doc) =>{
			if (doc.exists) {
				$('#note-data-5').val(doc.data().note);
				var element = document.querySelector('#note-data-5');
				AutoSize(element);
			}
		})
		function AutoSize(element)
		{
			element.style.height = "1px";
			element.style.height = (25+element.scrollHeight)+"px";
		}
	</script>
</body>
</html>