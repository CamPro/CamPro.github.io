<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Khai Sáng Bản Ngã</title>
	<link rel="stylesheet" href="./public/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="./public/plugins/sweetalert2/sweetalert2.min.css">
	<link rel="stylesheet" href="./public/css/adminlte.min.css">
	<link rel="stylesheet" href="./public/css/mystyle.css">
</head>

<body class="hold-transition sidebar-mini layout-navbar-fixed layout-fixed">

	<div class="wrapper">

		<nav class="main-header navbar navbar-expand border-bottom-0 text-sm navbar-light" id="header">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>
				<li class="nav-item d-none d-sm-inline-block">
					<a href="./" class="nav-link"><i class="fas fa-home"></i></a>
				</li>
			</ul>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<a href="/calendar.html" class="nav-link" id="my-clock"><i class="far fa-clock"></i></a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-comments"></i>
						<span class="badge badge-danger navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-bell"></i>
						<span class="badge badge-warning navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
						<i class="fas fa-th-large"></i>
					</a>
				</li>
			</ul>
		</nav>

		<aside class="main-sidebar sidebar-dark-primary elevation-4">
			<a href="./" class="brand-link text-md">
				<img src="https://graph.facebook.com/100007543845219/picture?height=100&width=100&access_token=6628568379%7Cc1e620fa708a1d5696fb991c1bde5662" class="brand-image img-circle elevation-3">
				<span class="brand-text font-weight-light" id="hello-user">MY LEARN</span>
			</a>
			<div class="sidebar">
				<div class="form-inline">
					<div class="input-group" data-widget="sidebar-search">
						<input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
						<div class="input-group-append">
							<button class="btn btn-sidebar">
								<i class="fas fa-search fa-fw"></i>
							</button>
						</div>
					</div>
					<div class="sidebar-search-results">
						<div class="list-group">
						</div>
					</div>
				</div>
				<nav class="mt-2 text-sm">
					<ul class="nav nav-pills nav-sidebar flex-column nav-child-indent" data-widget="treeview" role="menu" data-accordion="false">
						<li class="nav-item">
							<a href="/home.html" class="nav-link ">
								<i class="nav-icon fas fa-tachometer-alt"></i><p>Ngôi Nhà Vĩ Nhân</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/calendar.html" class="nav-link ">
								<i class="nav-icon fas fa-calendar-alt"></i><p>Lịch Treo Tường <i class="fas fa-star right text-warning"></i></p>
							</a>
						</li>
						<li class="nav-header text-warning">6. Áp dụng kiến thức</li>
						<li class="nav-item">
							<a href="/libraries.html" class="nav-link ">
								<i class="nav-icon fas fa-skating"></i><p>Thư Viện Cuộc Sống</p>
							</a>
						</li>
						<li class="nav-header text-warning">5. Tổng hợp kiến thức</li>
						<li class="nav-item">
							<a href="/knowledge.html" class="nav-link ">
								<i class="nav-icon fas fa-sitemap"></i><p>Xây Thành Đắp Lũy</p>
							</a>
						</li>
						<li class="nav-header text-warning">4. Phân tích thông tin</li>
						<li class="nav-item">
							<a href="/learning.html" class="nav-link ">
								<i class="nav-icon fas fa-rocket"></i><p>Tiêu Hóa Thông Tin</p>
							</a>
						</li>
						<li class="nav-header text-warning">3. Tóm tắt thông tin</li>
						<li class="nav-item">
							<a href="/classroom.html" class="nav-link ">
								<i class="nav-icon fas fa-chalkboard-teacher"></i><p>Lớp Học Quái Vật</p>
							</a>
						</li>
						<li class="nav-header text-warning">2. Tổ chức dữ liệu</li>
						<li class="nav-item">
							<a href="/courses.html" class="nav-link ">
								<i class="nav-icon fas fa-cubes"></i><p>Trèo Tường Vào Trường</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/posts.html" class="nav-link active">
								<i class="nav-icon fas fa-cloud-sun"></i><p>Kho Tàng Tri Thức</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/booking.html" class="nav-link ">
								<i class="nav-icon fas fa-book"></i><p>Từ Sách Đến Đời</p>
							</a>
						</li>
						<li class="nav-header text-warning">1. Thu thập dữ liệu</li>
						<li class="nav-item">
							<a href="/timeline.html" class="nav-link ">
								<i class="nav-icon fas fa-pencil-alt"></i><p>Nhật Ký Ý Tưởng</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/crawler.html" class="nav-link ">
								<i class="nav-icon fas fa-leaf"></i><p>Duyệt Kinh Điển</p>
							</a>
						</li>
						<li class="nav-header">------------------</li>
						<li class="nav-item">
							<a href="/backup.html" class="nav-link ">
								<i class="nav-icon fas fa-dove"></i><p>Trường Sinh Bất Lão</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/signin.html" class="nav-link">
								<i class="nav-icon fas fa-sign-in-alt"></i><p>Đăng Nhập</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="#" class="nav-link" id="sign-out">
								<i class="nav-icon fas fa-sign-out-alt"></i><p>Đăng Xuất</p>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</aside>

		<aside class="control-sidebar control-sidebar-dark">
			<div class="p-3">
				<h5>Thanh Công Cụ</h5>
				<div class="mb-4"><input type="checkbox" id="dark-mode" class="mr-1"><span>Dark Mode</span></div>
				
				<button class="btn btn-sm btn-default" id="fast-highlight"><span class="badge bg-success" id="fast-number"></span> <i class="fas fa-spell-check"></i> highlight</button>
				<textarea class="form-control" id="fast-content" rows="8"></textarea>
				<select class="form-control" id="fast-categories">
				</select>
				<select class="form-control" id="fast-courses">
				</select>
				<button class="btn btn-sm btn-primary" id="fast-knowledge"><i class="fas fa-edit"></i> Kiến Tạo</button>
			</div>
		</aside>
		<div class="content-wrapper">
			<div class="content-header">
				<div class="container-fluid">
					<div class="row">
						<div class="col-lg-2"><i class="fas fa-map-marker-alt"></i> <a href="#" id="post-source"></a></div>
						<div class="col-lg-2"><i class="fas fa-user-edit"></i> <a href="#" id="post-creator"></a></div>
						<div class="col-lg-2"><i class="fas fa-cubes"></i> <span id="post-category"></span></div>
						<div class="col-lg-2"><i class="far fa-thumbs-up"></i> <span id="post-vote"></span></div>
						<div class="col-lg-2"><i class="far fa-calendar-minus"></i> <span id="post-created"></span></div>
					</div>
					<div class="row">
						<table class="table table-responsive">
							<tr>
								<td><a href="" target="_blank" id="post-link"><button class="btn btn-sm btn-default"><i class="fas fa-external-link-alt"></i> Gốc</button></a></td>
								<td><a href="" id="post-edit"><button class="btn btn-sm btn-default"><i class="fas fa-edit"></i> Sửa</button></a></td>
								<td><button class="btn btn-sm btn-default" id="post-read"><i class="fas fa-eye"></i> Đã Đọc <span id="post-number-read"></span></button></td>
								<td><button class="btn btn-sm btn-default" id="post-delete"><i class="fas fa-trash"></i> Xóa</button></td>
								<td>
									<span class="input-group-append">
										<button type="button" class="btn btn-default btn-sm" id="page-col-minus"><i class="fas fa-minus"></i></button>
										<button type="button" class="btn btn-default btn-sm" id="page-col-plus"><i class="fas fa-plus"></i></button>
									</span>
								</td>
							</tr>
						</table>
					</div>
				</div>
			</div>
			<div class="content">
				<div class="container-fluid text-lg">
					<div class="row">
						<div class="col-lg-6 ml-auto mr-auto">
							<h2 class="m-0" id="post-title"></h2>
							<div id="post-content">
								*Nội dung*
							</div>
						</div>
					</div>
				</div>
				<div class="text-center">
					<button class="btn btn-sm btn-default" id="post-readed"><i class="fas fa-eye"></i> Đánh Dấu Đã Đọc <span id="post-number-readed"></span></button>
				</div>
			</div>
		</div>

		<footer class="main-footer">
			<div class="text-center">** Cắp sách đi học Trường Đời - Cố thêm 1 Chút thôi - Thừa hơn Thiếu **</div>
		</footer>
	</div>
	<div id="back-to-top" onclick="backToTop()"><i class="fa fa-chevron-up"></i></div>
	<script src="./public/plugins/jquery/jquery.min.js"></script>
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
	<script src="./public/plugins/moment/moment.min.js"></script>
	<script src="./public/plugins/sweetalert2/sweetalert2.min.js"></script>
	<script src="./public/js/adminlte.min.js"></script>
	<script src="./public/js/myfirebase.js"></script>
	<script src="./public/js/myscript.js"></script>
	<script type="text/javascript">
		let source = "";
		let slug = "";
		let docid = "";

		var url = new URL(window.location.href);
		source = url.searchParams.get("source");
		slug = url.searchParams.get("slug");
		docid = url.searchParams.get("docid");

		fetch('https://'+url.host+'/pages/'+source+'/'+slug+'.html')
		.then(response => response.text())
		.then(data => {
			$('#post-content').html(data);
		});

		fsdb.collection("posts").doc(docid).get().then((doc) => {
			if (doc.exists)
			{
				let docdata = doc.data();
				$('#post-source').text(docdata.source);
				$('#post-title').text(docdata.title);
				$('#post-creator').text(docdata.creator);
				$('#post-category').text(docdata.category);
				$('#post-vote').text(docdata.vote);
				$('#post-number-read').text(docdata.number_reads);

				$('#post-link').attr('href', docdata.link);
				$('#post-edit').attr('href', 'post/update.html?docid='+docid);

				let created = moment.unix(docdata.created).format("DD/MM/YYYY");
				$('#post-created').text(created);

				if (docdata.title) {
					document.title = docdata.title;
				}
			}
			else
			{
				console.log("No such document!");
			}
		}).catch((error) => {
			console.log("Error getting document:", error);
		});

		let number_reads = 0;
		fsdb.collection("posts").doc(docid).onSnapshot((doc) =>
		{
			number_reads = doc.data().number_reads;
			$('#post-number-read').text(number_reads);
			$('#post-number-readed').text(number_reads);
		});

		$('#post-readed, #post-read').click(function ()
		{
			$(this).prop('disabled', true);
			fsdb.collection("posts").doc(docid).update({
				number_reads: ++number_reads
			})
			.then(() => {}).catch((error) => {
				console.log(error);
			});
		});

		$('#post-delete').click(function ()
		{
			if (confirm('Xóa kinh điển?'))
			{
				console.log('delete');
			/*
			fsdb.collection("posts").doc(docid).delete()
			.catch((error) => {
			console.log(error);
		});*/
	}
});

		$('#page-col-plus').click(function ()
		{
			var content_class = $('#post-title').parent().attr('class');

			var col_number = content_class.match(/\d+/)[0];
			col_number = parseInt(col_number) + 1;
			
			if (col_number > 12) {
				return;
			}

			content_class = content_class.replace(/\d+/, col_number);

			$('#post-title').parent().attr('class', content_class);
		});

		$('#page-col-minus').click(function ()
		{
			var content_class = $('#post-title').parent().attr('class');

			var col_number = content_class.match(/\d+/)[0];
			col_number = parseInt(col_number) - 1;
			
			if (col_number < 1) {
				return;
			}

			content_class = content_class.replace(/\d+/, col_number);

			$('#post-title').parent().attr('class', content_class);
		});
	</script>
</body>
</html>