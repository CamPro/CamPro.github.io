<div>36<br>#computerscience #vmc<br><br>Hỏi: Thời gian dài nhất mà bạn từng dành ra để sửa lỗi code là bao lâu?<br>Trả lời: Andrew McGregor, Kỹ sư Xác thực Website tại Google (2013-hiện tại)<br>-------<br>Sáu năm, với tám kỹ sư. Hơn thế nữa, chúng tôi đã tìm ra lỗi tương tự trong Windows, MacOS, FreeBSD và Linux, với khoảng sáu hoặc bảy thiết bị. Trong trường hợp ví dụ của Linux và FreeBSD mà chúng tôi có thể sửa, những thay đổi cần thiết chỉ là thay đổi hai ký tự trong mã nguồn.<br> <br>Lỗi đó là như thế này:<br> <br>Wi-Fi có một thứ gì đó gọi là chế độ ad-hoc (ám chỉ giải pháp này được sử dụng cho một vấn đề cụ thể, rất khó để tổng quát hóa - nd), một thứ rất hiếm khi được sử dụng những ngày này (có lẽ vì lỗi này vẫn còn). Nó cho phép một nhóm các thiết bị Wi-Fi tạo thành một mạng với nhau, mà cần có không có điểm truy cập, và thực sự khá thích thú.<br> <br>Chúng tôi đang xây dựng các mạng ngoài trời lớn sử dụng chế độ ad-hoc, và chúng tôi nhận thấy rằng sau khoảng sáu tuần hoạt động liên tục, một thiết bị ngẫu nhiên sẽ bắt đầu trở nên rất chậm. Sự chậm trễ này lại có thể bị lây nhiễm; sau thiết bị đầu tiên ấy, mỗi lần khởi động lại sẽ có nguy cơ bị chậm khi nó hoạt động trở lại, cho đến khi toàn bộ mạng bị chậm và chúng tôi phải tắt tất cả các thiết bị, và tất cả các máy tính xách tay và thiết bị thử nghiệm từng tham gia vào mạng đó, và khởi động nguội mọi thứ (cold-start- khởi động khi mọi thứ đang mát, khác với khởi động nóng - nd). Điều này thật bất tiện vì một số thiết bị nằm ở nóc cột chiếu sáng 45 mét trên sân đường sắt, nơi chúng tôi phải có sự sắp xếp đặc biệt để có thể tiếp cận với các công tắc bật tắt...<br> <br>Chúng tôi đã tìm kiếm lỗi này trong nhiều năm. Chúng tôi tìm thấy hàng tá lỗi khác, và sửa được chúng; một vài bản sửa lỗi đã trở thành các phần tiêu chuẩn của Linux WiFi stack. Chúng tôi đã đổi sang phần cứng mới hai lần, một lần trong số đó có các chip của các nhà thiết kế mà chúng tôi cộng tác trong quá trình phát triển phần cứng.<br> <br>Chúng tôi đã phát hiện ra nhiều điều:<br> <br>• Đã có một khoảng thời gian tối thiểu trước khi điều này có thể đã không xảy ra.<br> <br>• Wi-Fi theo dõi thời gian kể từ khi mạng khởi động; ngay cả trước khi vấn đề về hiệu suất hiển hiện, hệ thống của chúng tôi sẽ được tuyên bố là đã sáu mươi nghìn năm tuổi, và già đi khoảng hai ngàn năm một ngày.<br> <br>o Điều này được thực hiện với một biến thời gian được gọi là TSF (Timing synchronization function - hàm đồng bộ hẹn giờ - ND) nằm trong các đơn vị của 802.11 TU, mỗi 1.024 micro-giây, kể từ khi mạng được thiết lập. <br> <br>• Các nút bị chậm sẽ không thể nhận thông tin đến khoảng 90% thời gian, nhưng có thể truyền tải tốt và luôn nhận được thông tin đúng bởi ngay cả một nút bị chậm khác.<br> <br>• Thiết bị Wi-Fi vào thời điểm đó rất tồi trong việc chọn những cài đặt máy phát tốt và chúng tôi có thể làm việc đó tốt hơn; chúng tôi sửa chữa vấn đề đó, và khi nó không bị mắc kẹt thì mạng bị chậm đó lại có tốc độ nhanh hơn gấp 10 lần, nhưng sự cố này thực ra lại làm cho vấn đề nút chậm trở nên tồi tệ hơn; các nút bị chậm lại chậm hơn nhiều, và từ đó lây lan nhanh hơn.<br> <br>Một ngày chúng tôi đã quá mệt mỏi với vấn đề này, chúng tôi quyết định rằng chúng tôi sẽ ngồi trong một phòng họp với tất cả các nhà phát triển những hạt nhân phần mềm của chúng tôi cùng nhau, chiếu mã nguồn trên màn hình máy chiếu và đọc những dòng lệnh cùng nhau.<br> <br>TSF chính thức là một số 64 bit, nhưng được xử lý ở những vị trí khác nhau tại hậu tố 24, 32 và 48 bit, và mã lệnh phải xác định các bit bị thiếu.<br> <br>Chúng tôi bắt đầu với tệp định nghĩa cấu trúc dữ liệu cơ bản của stack Wi-Fi. Chúng tôi đưa thêm vài chục dòng lệnh vào tệp tin đó và đã phát hiện ra một dòng mã mà bây giờ tôi không thể tìm thấy, nhưng nó đã định nghĩa kiểu biến sẽ được sử dụng để xử lý các giá trị thời gian. Và nó nói rằng TSF sẽ là một số nguyên 32 bit. Và tất cả chúng ta nhìn vào dòng mã đó, và cuối cùng tôi nói "u32 TSF? Tôi tự hỏi điều đó về mặt toán học đã đúng hẳn chưa... ". Chúng tôi đã đi tìm và nhìn vào mọi chỗ mà nó được sử dụng, và không thể thấy được rằng nó có được sử dụng hay không.<br> <br>Vì vậy, chúng tôi quyết định làm điều hiển nhiên, và thay đổi nó thành một số nguyên 64 bit. Sau đó chúng tôi xây dựng lại code của chúng mình và khởi động lại mạng, mất một tuần để làm.<br> <br>Ba tháng sau, mạng vẫn còn tốt và chúng tôi tuyên bố chúng tôi đã sửa được nó.<br> <br>Chúng tôi đã thử nghiệm tất cả thiết bị Wi-Fi mà chúng tôi có thể chạm tay vào, và khoảng 3/4 trong số đó có cùng một lỗi. Những thiết bị có thể chạy những hệ điều hành khác nhau, chủ yếu là máy tính xách tay của Apple, đôi khi có lỗi trong hai hoặc ba hệ điều hành. Chúng tôi đã báo cáo sự cố này cho tất cả công ty mà chúng tôi có thể tìm thấy: Apple, Microsoft, bốn nhà sản xuất chip, và nhiều cty khác.<br> <br>Hóa ra có khá nhiều bản thực thi tồi tệ hơn thế: thay vì sử dụng một số 32 bit, họ đã sử dụng 24 bit, và sau đó mạng chạy chế độ ad-hoc của họ sẽ sập sau 4 giờ và 46 phút ... (Tiết kiệm thế làm cái *beep gì k biết).<br> <br>Nhưng nếu bạn thắc mắc tại sao chúng ta có Bluetooth cho nhiều thứ như vậy trong khi Wi-Fi có thể làm tương tự hoặc tốt hơn ... Lý do nằm ở lỗi này, tôi tin là vậy. Wi-Fi chỉ không đáng tin cậy trong chế độ ad-hoc trong những khoảng thời gian quan trọng, và Bluetooth đã trở thành cách để làm những việc này.<br><br>https://www.quora.com/What-is-the-longest-amount-of-time-you-have-spent-fighting-a-code-bug/answer/Andrew-McGregor-12<br><br><img src='https://scontent.fhan17-1.fna.fbcdn.net/v/t1.18169-9/22540210_1988631448050080_9089088010184299390_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=ca434c&_nc_ohc=KIj8FjdLnzkAX_19HGe&_nc_ht=scontent.fhan17-1.fna&edm=AFuVL-cEAAAA&oh=00_AfDGfWhQUl6RXNw38I2innjMEG-XlzT1xu97WBXKIHp1Cg&oe=63D0D4E6'></div>