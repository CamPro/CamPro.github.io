<div># **Đôi điều về dấu chấm phẩy trong JavaScript**<br><br>#medium #JavaScript #code<br><br>[Tác giả: Sanket Meghani<br><br>Dịch: Bùi Thanh Lâm<br><br>*Lưu ý: có hai bài viết gốc, cùng tác giả, nằm cùng một series. Vì vậy mình dịch cả hai bài ấy và kết nối chúng vào thành một bài dịch. Tuy nhiên, nội dung vẫn được bảo đảm 100% như cả hai bài gốc, tuy rằng cách trình bày sẽ có một chút thay đổi.*<br><br>Link bài viết gốc:<br><br>1. [https://codeburst.io/ecmascript-automatic-semicolon-insertion-50f09091e377](https://codeburst.io/ecmascript-automatic-semicolon-insertion-50f09091e377)<br><br>2. [https://codeburst.io/why-i-prefer-to-use-semicolon-in-javascript-f00c303547](https://codeburst.io/why-i-prefer-to-use-semicolon-in-javascript-f00c303547) ]<br><br>Về JavaScript (JS), luôn có một cuộc tranh cãi không hồi kết trong cộng đồng lập trình viên, rằng có nên viết dấu chấm phẩy mỗi khi kết thúc một câu lệnh hay không. Có hai trường phái chính, một là “Phải luôn luôn dùng dấu chấm phẩy”, hai là “Đừng bao giờ dùng dấu chấm phẩy”. Nguyên nhân chia làm hai thái cực rõ rệt này là bởi, đa phần trong số chúng ta nghĩ rằng dấu chấm phẩy là không bắt buộc trong JS.<br><br>Theo tài liệu của ECMAScript, nếu một câu lệnh không được kết thúc thủ công bằng một dấu chấm phẩy, **trong những trường hợp nhất định, dấu chấm phẩy sẽ được tự động thêm vào bởi trình dịch JS.**<br><br>*“Để thuận tiện, những dấu chấm phẩy có thể được bỏ qua trong mã nguồn trong một số trường hợp. Đối với những trường hợp này, dấu chấm phẩy sẽ được tự động thêm vào mã nguồn “ – Theo tài liệu của ECMAScript*<br><br>Nói cách khác: câu lệnh trong JS bắt buộc phải kết thúc bằng dấu chấm phẩy. Tuy nhiên, nếu lập trình viên không thích viết nó một cách thủ công, trình dịch JS sẽ tự động thêm nó cho bạn trong một số trường hợp nhất định.<br># **Thêm dấu chấm phẩy tự động trong JS**<br><br>Về vấn đề này, có 03 quy tắc cơ bản mà trình dịch JS sẽ dựa vào đó để quyết định xem có chèn dấu chấm phẩy vào đó hộ bạn hay không.<br>## **Quy tắc #1**<br><br>***Từ trái sang phải, nếu gặp một ký tự vi phạm, dấu chấm phẩy sẽ được tự động thêm vào đó.***<br><br>Cụ thể, dấu chấm phẩy sẽ được chèn vào trước ký tự vi phạm khi và chỉ khi thoả mãn một trong các điều kiện sau:<br><br>1. Ký tự vi phạm được ngăn cách với ký tự trước đó bởi ít nhất một dấu xuống dòng.<br><br>2. Ký tự vi phạm đó là dấu “}”<br><br>***Ký tự vi phạm là ký tự không hợp lệ bởi bất kỳ cú pháp nào.***<br><br>Cùng tìm hiểu ví dụ sau đây để hiểu rõ hơn:<br>> let a = 10<br>> let b = true<br>> <br>> if(b) {<br>> console.log('B is truthy')<br>> }<br>> <br>> console.log('A is ', a)<br><br>Theo quy tắc 1, trình dịch JS sẽ dò tự trái sang phải của dòng 1. Tiếp tục gặp đến ký tự “l” ở dòng 2: đây là ký tự vi phạm đầu tiên nó gặp, bởi “l” không hợp lệ bởi bất kỳ cú pháp nào. Có nghĩa chúng ta đang có “let a = 10” và một ký tự vi phạm đó là “l”, giữa chúng có một dấu ngắt dòng. Theo khoản 1, điều 1, một dấu chấm phẩy sẽ được tự động thêm vào trước đó.<br><br>Tương tự như vậy, dấu chấm phẩy sẽ được chèn vào cuối dòng 2. Tóm lại đoạn code sẽ trở thành như sau:<br>> let a = 10;<br>> let b = true;<br>> <br>> if(b) {<br>> console.log('B is truthy')<br>> }<br>> <br>> console.log('A is ', a)<br><br>Theo khoản 2, điều 1, một dấu chấm phẩy khác cũng được chèn vào cuối dòng 5. Vì vậy, đoạn code sẽ trở thành:<br>> let a = 10;<br>> let b = true;<br>> <br>> if(b) {<br>> console.log('B is truthy');<br>> }<br>> <br>> console.log('A is ', a)<br>## **Quy tắc #2**<br><br>***Từ trái sang phải, nếu kết thúc đoạn mã lệnh, dấu chấm phẩy sẽ được tự động chèn thêm.***<br><br>Quy tắc này quá đơn giản rồi. Nếu kết thúc đoạn code mà chưa có dấu chấm phẩy, nó sẽ tự thêm vào cho bạn. Với điều luật này, cũng ví dụ trên, một dấu chấm phẩy sẽ được thêm tiếp vào cuối dòng 8:<br>> let a = 10;<br>> let b = true;<br>> <br>> if(b) {<br>> console.log('B is truthy');<br>> }<br>> <br>> console.log('A is ', a);<br>## **Quy tắc #3**<br><br>***Từ trái sang phải, nếu một ký tự hợp lệ bởi một cú pháp nào đó, nhưng cú pháp đó là một cú pháp hạn chế, và ngăn cách với ký tự sau nó bởi ít nhất một dấu xuống dòng, thì một dấu chấm phẩy sẽ được tự động thêm vào.***<br><br>“Cú pháp hạn chế” thực ra là một cách nói mỹ miều cho đám continue, break, return và throw.<br><br>***Cú pháp hạn chế bao gồm câu lệnh continue, break, return và throw.***<br><br>Vậy nói cho đơn giản, điều luật này có nghĩa rằng nếu có một trong 4 câu lệnh cú pháp hạn chế kia, sau nó là ít nhất một dấu xuống dòng, thì dấu chấm phẩy sẽ được thêm vào sau nó. Xét ví dụ sau:<br>> let myFunction = () => {<br>> return<br>> }<br>> <br>> const result = myFunction()<br><br>Theo điều 3, ta có return ở dòng 2, sau đó là 1 dấu xuống dòng, rồi đến dấu “}”. Vì thế, trình dịch JS sẽ thêm một dấu chấm phẩy vào ngay sau return như sau:<br>> let myFunction = () => {<br>> return;<br>> }<br>> <br>> const result = myFunction()<br><br>Trên đây chúng ta đã đi qua những quy tắc cơ bản nhất về việc JS tự động thêm dấu chấm phẩy vào code. Tuy chưa nói đến tất cả các trường hợp, nhưng đó cũng là hòm hòm rồi. Tiếp theo đây sẽ là một vài ví dụ về việc sử dụng dấu chấm phẩy trong JS, và lý do vì sao tôi luôn thích tự viết chấm phẩy khi code JS.<br><br>*(ND: đây là phần chuyển từ bài 1 sang bài 2 của tác giả).*<br># **Lý do tôi ưa thích việc viết dấu chấm phẩy khi code JS**<br><br>Chính vì JS không bắt lập trình viên phải viết dấu chấm phẩy, nên có rất nhiều ý kiến khác nhau xung quanh vấn đề này. Một số lập trình viên luôn luôn tự viết nó, một số khác thì không bao giờ và số còn lại thì dùng tuỳ lúc.<br><br>Là một thằng vốn gốc Java, việc viết chấm phẩy để kết thúc mỗi câu lệnh đối với tôi là hiển nhiên. Dưới đây là một vài ví dụ sẽ dẫn đến lỗi nếu bạn không dùng dấu chấm phẩy đúng cách, cũng chính là lý do cho thói quen viết code của tôi.<br><br>Xét ví dụ sau:<br>> const a = 5<br>> const b = 10<br>> const c = a + b<br>> <br>> [1, 2, 3].forEach((e)  => console.log(e))<br><br>Trông ổn đúng không. Nhưng khi chạy, nó sẽ báo lỗi như sau:<br>> [1, 2, 3].forEach((e) => console.log(e))<br>           ^<br>> TypeError: Cannot read property 'forEach' of undefined<br><br>Vì không có dấu chấm phẩy nào được viết thủ công, trình dịch JS sẽ tự thêm vào. Theo điều 1, nó sẽ tìm lấy ký tự vi phạm từ trái sang phải, từ trên xuống dưới. Đến chữ const ở dòng 2, nó sẽ thêm dấu chấm phẩy vào cuối dòng 1. Tương tự như vậy, cuối dòng 2 cũng được tự động thêm một dấu chấm phẩy. Nhưng đến dòng 3, kết thúc hàng 3 là một dấu xuống dòng, nhưng tiếp đó là ký tự “[“, đây là ký tự hợp lệ (không vi phạm), bởi nếu b là mảng thì b[ là hợp lệ. Vì thế, không có dấu chấm phẩy nào được chèn vào chỗ này cả. Thành ra, dòng 3, 4, 5 sẽ được dịch là *b[1, 2, 3].forEach. b[1, 2, 3]* rõ ràng không xác định nên gây ra báo lỗi như trên.<br><br>*(ND: để tránh lỗi tương tự, dòng lệnh nào bắt đầu bằng “[“ hoặc “(“, ta nên thêm dấu chấm phẩy vào ngay đầu dòng. Trong ví dụ trên:*<br><br>;[1, 2, 3].forEach((e) => console.log(e))<br><br>*Kỹ thuật này gọi là “dấu chấm phẩy phòng thủ” (defensive semicolon).)*<br><br>Đó ví dụ về việc lỗi do không tự động thêm dấu chấm phẩy. Dưới đây là một ví dụ cho việc lỗi do việc tự động thêm dấu chấm phẩy không đúng chỗ cần thêm:<br>> const sum = (a, b) => {<br>> return<br>> {<br>> result: a + b<br>> }<br>> }<br>> <br>> const result = sum(1, 3)<br>> console.log(result)<br><br>Dành chút thời gian nghĩ xem đoạn lệnh này ra kết quả là gì. Một object {result: 4} đúng không? Thế nhưng khi chạy, kết quả trả về là undefined.<br><br>Bởi, theo điều 3, return là một cú pháp hạn chế, vì thế trình dịch JS sẽ tự thêm dấu chấm phẩy vào ngay sau return, nên dòng 3, 4 và 5 sẽ không được dịch tới. Để đoạn lệnh chạy đúng, ta phải viết dấu “{“ cùng dòng với return, để JS không tự thêm dấu chấm phẩy vào cuối dòng 2.<br><br>*(ND: Đây cũng là một phần lý do mà các lập trình viên JS thường viết kiểu:*<br><br>*something {*<br><br>*// something*<br><br>*}*<br><br>*Thay vì kiểu:*<br><br>*something*<br><br>*{*<br><br>*// something*<br><br>*}*<br><br>*như nhiều lập trình viên dùng C#, Java, v.v…)*<br># **Kết luận**<br><br>Bởi JS là ngôn ngữ lập trình thông dịch, rất khó để phát hiện ra lỗi liên quan đến chấm phẩy. Bạn có thể cài thêm tool để tự ép mình dùng chấm phẩy mọi lúc, hoặc ngược lại.<br><br>Cá nhân tôi cho rằng dấu chấm phẩy phụ thuộc vào thói quen của mỗi người thôi. Vấn đề là hãy nhất quán: nếu đã dùng thì luôn luôn dùng đi, còn không thì đừng dùng, vậy thôi.<br><br>*(ND: có hai trường hợp BẮT BUỘC phải dùng chấm phẩy. Đó là:*<br><br>*1.* *Viết nhiều câu lệnh trên cùng một dòng*<br><br>*2.* *Trong for(), sau 2 thành phần đầu tiên phải có chấm phẩy, còn sau thành phần thứ ba thì không được có chấm phẩy*<br><br>*Ngoài ra, lưu ý thêm những điều mà OP nói.*<br><br>*Còn lại, hãy tận hưởng một thế giới không có chấm phẩy. Lêu lêu ông nào code Java, xoá chấm phẩy là lỗi tùm lum; lêu lêu mấy ông code Python, vào tab loạn lên rồi các ông ngồi khóc. JS tránh được cả 2 phiền toái này, mặc dù nó rất củ chuối.)*<br><br><img src='https://scontent.fhan17-1.fna.fbcdn.net/v/t1.6435-9/88360945_1489122617914351_3671869924780802048_n.jpg?stp=dst-jpg_s720x720&_nc_cat=104&ccb=1-7&_nc_sid=ca434c&_nc_ohc=XPjQ_ovyhQkAX9FGESl&_nc_ht=scontent.fhan17-1.fna&edm=AFuVL-cEAAAA&oh=00_AfDQAco7Z5G8I7ViA2w34dPBK3msnsEBYU_HaMPZrRhRmQ&oe=63D0DFAB'></div>