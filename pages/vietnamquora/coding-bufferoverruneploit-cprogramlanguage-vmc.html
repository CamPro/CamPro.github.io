<div>415<br>#coding #bufferOverrunEploit #CprogramLanguage #vmc<br><br>Bạn có thể viết một đoạn code có khả năng bị tấn công và sau đó minh họa cách mà hacker lợi dụng lỗ hổng đó không?<br> <br>Steve Baker, Blogger LetsRunWithIt.com (2013-nay)<br>===============<br><br>Để tránh vẽ đường cho bọn đần chạy, tôi sẽ chỉ đưa ra một ví dụ cũ kỹ lỗi thời mà thôi.<br> <br>Nó minh họa một vài trường hợp lỗi có thể gặp phải - nhưng hi vọng là, chỉ có ít chương trình vẫn còn dính lỗi này mà thôi.<br> <br>Trong ngôn ngữ C, có một hàm với tên gọi “gets” để đọc một dòng ký tự ASCII từ một luồng đầu vào nào đó:<br> <br>1.   char *gets( char *buffer) ;<br><br>Nếu bạn chạy đoạn mã này, nó sẽ đọc dữ liệu vào (tức là những thứ được gõ vào từ bàn phím) vào bộ đệm cho tới khi đọc được một ký tự “hoàn tất” (trans - thường là “enter”).<br> <br>Vì thế có thể sẽ có một vài lập trình viên yếu kém viết thế này:<br><br>1. bool checkPassword ()<br>2. {<br>3.   char buffer [ 100 ] ;<br>4.   int hasPermission = 0 ;<br>5.  <br>6.   printf ( "Please enter your password: " ) ;<br>7.   gets(buffer) ;<br>8.  <br>9.   if ( strcmp ( buffer, "wybbl3" ) == 0 )<br>10.     hasPermission = true ;<br>11.   else<br>12.     printf ( "Incorrect Password!\n" ) ;<br>13.  <br>14.   return hasPermission ;<br>15. }<br><br>(Giờ đây thì, các lập trình viên “đích thực” ấy đang mơ hồ hồi tưởng lại và có cảm giác thốn không hề nhẹ!)<br> <br>Và - hàm “checkPassword()” đặt “hasPermission” thành 0 (không được phép) - rồi sau đó nó sẽ yêu cầu bạn nhập mật khẩu vào - và nếu mật khẩu đó là “wybbl3” thì nó sẽ chuyển “hasPermission” thành ‘1’ (được cấp quyền) - còn không, nó sẽ hiện dòng chữ “Incorrect Password!” và trả về ‘0’ - tức là “false”.<br> <br>Đối với những mật khẩu “thông thường”, hàm này sẽ hoạt động được. Bất cứ ai kiểm tra đoạn mã này có lẽ sẽ thử gõ một vài mật khẩu sai rồi sau đó là mật khẩu đúng, có thể sẽ gõ Enter mà không có ký tự nào - và có vẻ như mọi thứ đều hoạt động trơn tru, vì thế đoạn này sẽ được đưa vào code của sản phẩm.<br> <br>NHƯNG nếu luồng đầu vào lại có trên 100 ký tự (thực sự thì là 99) - nó sẽ cần nhiều không gian hơn so với những gì có trong “buffer”.<br> <br>Trong C thì, chẳng có cách nào để hàm này có thể biết không gian có trong một mảng là bao nhiêu, vì thế nếu có quá nhiều dữ liệu, thì, liệu chuyện gì sẽ xảy ra?<br> <br>Chà, ở ví dụ trên, “buffer” là một biến địa phương, nên nó được lưu trữ trên stack... và biến “hasPermission” cũng thế.<br> <br>Vì thế NẾU một kẻ ma quái nào đó muốn hack máy tính của bạn, tất cả những gì mà họ phải làm là gõ trên 100 ký tự vào máy tính khi có màn hình nhắc mật khẩu xuất hiện!<br> <br>Mảng buffer không có đủ không gian dành cho (tạm cho là) 101 ký tự - nên ký tự thứ 101 sẽ vô tình được ấn vào không gian bộ nhớ tiếp theo - đó là byte đầu tiên dành cho biến “hasPermission”!<br> <br>Giờ đây, hàm so sánh xâu không chạy được vì gã kia không biết mật khẩu - nhưng lại chẳng hề quan trọng chút nào bởi biến “hasPermission” giờ đây chứa một ký tự khác không từ byte thứ 101 mà gã kia gõ vào.<br> <br>Có nghĩa là hàm “checkPassword” trả về giá trị “true” ngay cả khi hắn không biết được mật khẩu!<br> <br>CHÚC MỪNG! BẠN ĐÃ BỊ HACK!<br> <br>Cách này được gọi là “khai thác tràn bộ đệm” và nó vẫn là một cách phổ biến để đột nhập vào các đoạn mã.<br> <br>Nếu họ có thể truy cập vào mã nguồn chương trình của bạn - họ sẽ nhìn vào những tình huống như thế này và khai thác các lỗ hổng một cách dễ dàng - nhưng ngay cả khi họ không có mã nguồn, họ sẽ vẫn chạy chương trình đưa những thứ rác rưởi linh tinh cho tới khi nó hoạt động sai lầm theo cách nào đó... Sau đó họ sẽ tìm xem code bị hổng chỗ nào và thử lại với một vài input có tính toán để xem xem dạng dữ liệu nào sẽ bẻ gãy được nó và bằng cách nào.<br> <br>Hướng dẫn sử dụng thư viện C chuẩn giờ đã gắn cờ hàm “gets” là “deprecated” (lỗi thời) vì lý do này.<br> <br>https://linux.die.net/man/3/gets<br> <br>Nó nói rằng “Không bao giờ sử dụng hàm gets()”. …Và thực sự là chuẩn 100% luôn!<br> <br>Cách khai thác lỗi tràn bộ đệm có thể tinh vi hơn nhiều, và thường họ có thể viết mã máy đưa vào trong stack và thực thi nó, việc này cho phép thực hiện những khai thác còn tinh quái hơn NHIỀU.<br><br>https://www.quora.com/Can-you-write-a-piece-of-code-that-is-susceptible-to-be-hacked-and-then-demonstrate-how-a-hacker-would-hack-it/answer/Steve-Baker-100<br><br><img src='https://scontent.fhan17-1.fna.fbcdn.net/v/t1.6435-9/47296391_2250820491831173_1629284689707532288_n.jpg?stp=dst-jpg_s720x720&_nc_cat=109&ccb=1-7&_nc_sid=ca434c&_nc_ohc=a6loWTufGnEAX-_3n6C&_nc_ht=scontent.fhan17-1.fna&edm=AFuVL-cEAAAA&oh=00_AfBn07WfWEGuaEUqKKCCurdRIcM62JxyPwK_J6PZJSh_Dw&oe=63D0CDE9'></div>