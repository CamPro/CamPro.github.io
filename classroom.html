<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Lớp Học Quái Vật</title>
	<link rel="stylesheet" href="./public/plugins/fontawesome/css/all.min.css">
	<link rel="stylesheet" href="./public/plugins/sweetalert2/sweetalert2.min.css">
	<link rel="stylesheet" href="./public/plugins/select2/css/select2.min.css">
	<link rel="stylesheet" href="./public/css/adminlte.min.css">
	<link rel="stylesheet" href="./public/css/mystyle.css">
</head>

<body class="hold-transition sidebar-mini layout-navbar-fixed layout-fixed">

	<div class="wrapper">

		<nav class="main-header navbar navbar-expand border-bottom-0 text-sm navbar-light" id="header">
			<ul class="navbar-nav">
				<li class="nav-item">
					<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
				</li>
				<li class="nav-item d-none d-sm-inline-block">
					<a href="./" class="nav-link"><i class="fas fa-home"></i></a>
				</li>
			</ul>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<a href="/calendar.html" class="nav-link" id="my-clock"><i class="far fa-clock"></i></a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-comments"></i>
						<span class="badge badge-danger navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item dropdown">
					<a class="nav-link" data-toggle="dropdown" href="#">
						<i class="far fa-bell"></i>
						<span class="badge badge-warning navbar-badge">0</span>
					</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
						<i class="fas fa-th-large"></i>
					</a>
				</li>
			</ul>
		</nav>

		<aside class="main-sidebar sidebar-dark-primary elevation-4">
			<a href="./" class="brand-link text-md">
				<img src="https://graph.facebook.com/100007543845219/picture?height=100&width=100&access_token=6628568379%7Cc1e620fa708a1d5696fb991c1bde5662" class="brand-image img-circle elevation-3">
				<span class="brand-text font-weight-light" id="hello-user">MY LEARN</span>
			</a>
			<div class="sidebar">
				<div class="form-inline">
					<div class="input-group" data-widget="sidebar-search">
						<input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
						<div class="input-group-append">
							<button class="btn btn-sidebar">
								<i class="fas fa-search fa-fw"></i>
							</button>
						</div>
					</div>
					<div class="sidebar-search-results">
						<div class="list-group">
						</div>
					</div>
				</div>
				<nav class="mt-2 text-sm">
					<ul class="nav nav-pills nav-sidebar flex-column nav-child-indent" data-widget="treeview" role="menu" data-accordion="false">
						<li class="nav-item">
							<a href="/home.html" class="nav-link ">
								<i class="nav-icon fas fa-tachometer-alt"></i><p>Ngôi Nhà Vĩ Nhân</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/calendar.html" class="nav-link ">
								<i class="nav-icon fas fa-calendar-alt"></i><p>Lịch Treo Tường <i class="fas fa-star right text-warning"></i></p>
							</a>
						</li>
						<li class="nav-header text-warning">6. Áp dụng kiến thức</li>
						<li class="nav-item">
							<a href="/libraries.html" class="nav-link ">
								<i class="nav-icon fas fa-skating"></i><p>Thư Viện Cuộc Sống</p>
							</a>
						</li>
						<li class="nav-header text-warning">5. Tổng hợp kiến thức</li>
						<li class="nav-item">
							<a href="/knowledge.html" class="nav-link ">
								<i class="nav-icon fas fa-sitemap"></i><p>Xây Thành Đắp Lũy</p>
							</a>
						</li>
						<li class="nav-header text-warning">4. Phân tích thông tin</li>
						<li class="nav-item">
							<a href="/learning.html" class="nav-link ">
								<i class="nav-icon fas fa-rocket"></i><p>Tiêu Hóa Thông Tin</p>
							</a>
						</li>
						<li class="nav-header text-warning">3. Tóm tắt thông tin</li>
						<li class="nav-item">
							<a href="/classroom.html" class="nav-link active">
								<i class="nav-icon fas fa-chalkboard-teacher"></i><p>Lớp Học Quái Vật</p>
							</a>
						</li>
						<li class="nav-header text-warning">2. Tổ chức dữ liệu</li>
						<li class="nav-item">
							<a href="/courses.html" class="nav-link ">
								<i class="nav-icon fas fa-cubes"></i><p>Trèo Tường Vào Trường</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/posts.html" class="nav-link ">
								<i class="nav-icon fas fa-cloud-sun"></i><p>Kho Tàng Tri Thức</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/booking.html" class="nav-link ">
								<i class="nav-icon fas fa-book"></i><p>Từ Sách Đến Đời</p>
							</a>
						</li>
						<li class="nav-header text-warning">1. Thu thập dữ liệu</li>
						<li class="nav-item">
							<a href="/timeline.html" class="nav-link ">
								<i class="nav-icon fas fa-pencil-alt"></i><p>Nhật Ký Ý Tưởng</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/crawler.html" class="nav-link ">
								<i class="nav-icon fas fa-leaf"></i><p>Duyệt Kinh Điển</p>
							</a>
						</li>
						<li class="nav-header">------------------</li>
						<li class="nav-item">
							<a href="/backup.html" class="nav-link ">
								<i class="nav-icon fas fa-dove"></i><p>Trường Sinh Bất Lão</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="/signin.html" class="nav-link">
								<i class="nav-icon fas fa-sign-in-alt"></i><p>Đăng Nhập</p>
							</a>
						</li>
						<li class="nav-item">
							<a href="#" class="nav-link" id="sign-out">
								<i class="nav-icon fas fa-sign-out-alt"></i><p>Đăng Xuất</p>
							</a>
						</li>
					</ul>
				</nav>
			</div>
		</aside>

		<aside class="control-sidebar control-sidebar-dark">
			<div class="p-3">
				<h5>Thanh Công Cụ</h5>
				<div class="mb-4"><input type="checkbox" id="dark-mode" class="mr-1"><span>Dark Mode</span></div>
				
				<button class="btn btn-sm btn-default" id="fast-highlight"><span class="badge bg-success" id="fast-number"></span> <i class="fas fa-spell-check"></i> highlight</button>
				<textarea class="form-control" id="fast-content" rows="8"></textarea>
				<select class="form-control" id="fast-categories">
				</select>
				<select class="form-control" id="fast-courses">
				</select>
				<button class="btn btn-sm btn-primary" id="fast-knowledge"><i class="fas fa-edit"></i> Kiến Tạo</button>
			</div>
		</aside>

		<div class="content-wrapper" style="background-color: lightyellow;">
			<div class="content-header">
				<div class="container-fluid">
					<h1 class="m-0">Lớp Học Quái Vật</h1>
				</div>
			</div>
			<div class="content">
				<div class="container-fluid">

					<div class="row">
						<div class="col-sm-8">
							<div class="card card-default">
								<div class="card-header">
									<div class="row">
										<div class="col-sm-9">
											<div class="input-group">
												<textarea class="form-control" rows="1" id="room-content" placeholder="<html>"></textarea>
												<div class="input-group-append">
													<span class="btn input-group-text" id="room-lesson-format" data-toggle="tooltip" title="Định dạng"><i class="fas fa-code"></i></span>
													<span class="btn input-group-text" id="room-lesson-completed" data-toggle="tooltip" title="Đã chinh phục"></span>
												</div>
											</div>
										</div>
										<div class="col-sm-3">
											<div class="btn-group float-right">
												
												<button type="button" class="btn btn-default btn-block" id="room-view" data-toggle="tooltip" title="Xem nội dung">Bắt Đầu</button>
												<a href="#" class="btn btn-default" id="lesson-next" data-toggle="tooltip" title="Bài tiếp theo"></a>
											</div>
										</div>
									</div>
								</div>
								<div class="card-body" id="card-content">
								</div>
								<div class="card-footer">
									<button class="btn btn-xs btn-default" id="page-height-plus" data-toggle="tooltip" title="Tăng chiều dài"><i class="fas fa-plus"></i></button>
									<button class="btn btn-xs btn-default" onclick="SetFrameHeight(200)" data-toggle="tooltip" title="Chiều dài 200px">200px</button>
									<button class="btn btn-xs btn-default" onclick="SetFrameHeight(400)" data-toggle="tooltip" title="Chiều dài 400px">400px</button>
									<button class="btn btn-xs btn-default" onclick="SetFrameHeight(500)" data-toggle="tooltip" title="Chiều dài 500px">500px</button>
									<button class="btn btn-xs btn-default" onclick="SetFrameHeight(600)" data-toggle="tooltip" title="Chiều dài 600px">600px</button>
									<button class="btn btn-xs btn-default" onclick="SetFrameHeight(800)" data-toggle="tooltip" title="Chiều dài 800px">800px</button>
									<button class="btn btn-xs btn-default float-right" id="page-height-minus" data-toggle="tooltip" title="Giảm chiều dài"><i class="fas fa-minus"></i></button>
								</div>
							</div>
						</div>
						<div class="col-sm-4">
							<div class="card card-default card-fixed">
								<div class="card-header">
									<div class="input-group">
										<div class="input-group-prepend">
											<span class="btn input-group-text" id="text-zoom"><i class="fas fa-text-height"></i></span>
										</div>
										<select class="form-control select2" id="room-courses">
										</select>
										<div class="input-group-append">
											<span class="btn input-group-text" id="room-view-hide" data-toggle="tooltip" title="Ẩn thanh thông tin"><i class="fas fa-expand"></i></span>
										</div>
									</div>
									<div class="input-group">
										<input type="text" class="form-control" id="room-lesson" value="" placeholder="Tiêu đề bài giảng">
										<div class="input-group-append">
											<span class="btn input-group-text" id="room-lesson-save" data-toggle="tooltip" title="Lưu bài học"><i class="fas fa-save"></i></span>
										</div>
									</div>
								</div>
								<div class="card-body">
									<div class="form-group">
										<div class="input-group">
											<textarea class="form-control" id="room-brain" rows="2" placeholder="Thông tin hữu ích, Ghi lại để ngẫm"></textarea>
											<div class="input-group-append">
												<span class="btn btn-primary input-group-text" id="room-study-save" data-toggle="tooltip" title="Lưu thông tin hữu ích"><i class="far fa-lightbulb"></i></span>
											</div>
										</div>
									</div>
									<div class="form-group" id="room-list">
									</div>
								</div>
							</div>
						</div>
					</div>

				</div>
			</div>
		</div>

		<footer class="main-footer">
			<div class="text-center">** Cắp sách đi học Trường Đời - Cố thêm 1 Chút thôi - Thừa hơn Thiếu **</div>
		</footer>

		<div class="btn-group" id="toolbox">
			<button type="button" class="btn bg-warning" id="toolbox-highlight"><i class="fas fa-heading"></i></button>
			<button type="button" class="btn bg-primary" id="toolbox-bold"><i class="fas fa-bold"></i></button>
			<button type="button" class="btn bg-info btn-sm" id="toolbox-undo"><i class="fas fa-undo"></i></button>
		</div>
	</div>
	<div id="back-to-top" onclick="backToTop()"><i class="fa fa-chevron-up"></i></div>
	<script src="./public/plugins/jquery/jquery.min.js"></script>
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
	<script src="./public/plugins/moment/moment.min.js"></script>
	<script src="./public/plugins/sweetalert2/sweetalert2.min.js"></script>
	<script src="./public/plugins/bootstrap/bootstrap.bundle.min.js"></script>
	<script src="./public/plugins/select2/js/select2.full.min.js"></script>
	<script src="./public/js/adminlte.min.js"></script>
	<script src="./public/js/myfirebase.js"></script>
	<script src="./public/js/myscript.js"></script>
	<script type="text/javascript">

		var lesson_index = null;
		var lesson_doc = null;
		var course_id = null;
		var timer = null;
		var select_text = null;
		var html_content = null;

		var url = new URL(window.location.href);
		lesson_index = url.searchParams.get("lesson");

		// nếu có id bài học thì lấy toàn bộ thông tin bài học
		if (lesson_index)
		{
			fsdb.collection("lessons").doc(lesson_index).get().then((doc) => {
				if (doc.exists)
				{
					let docdata = doc.data();

					lesson_doc = doc;
					course_id = docdata.course_id;

					$('#room-content').val(docdata.content);
					$('#room-lesson').val(docdata.lesson);

					$('div.content-wrapper h1').text(docdata.lesson);
					document.title = docdata.lesson;

					GetCourses(docdata.course_id);

					if (docdata.completed && docdata.completed == true)
					{
						$('#room-lesson-completed').addClass('text-success').html('<i class="fas fa-user-graduate"></i>');
						$('#room-view').text('Đã Học');
					}
					else
					{
						$('#room-lesson-completed').html('<i class="fas fa-hiking"></i>');
					}

					// lấy danh sách study của bài học
					fsdb.collection("informations").where('course_id', '==', docdata.course_id).where('lesson_id', '==', lesson_index).orderBy("created_at", "desc").get()
					.then((querySnapshot) => {
						querySnapshot.forEach((doc) => {
							let docid = doc.id;
							let docdata = doc.data();

							var html = '<div class="input-group">';
							html += '<textarea class="form-control room-brains" rows="1" data-study-id="' + docid + '" onchange="StudyChange(this)">' + docdata.study + '</textarea>';
							html += '<div class="input-group-append">';
							html += '<span class="btn btn-danger input-group-text btn-xs" data-study-id="' + docid + '" onclick="DeleteStudy(this)"><i class="fas fa-trash-alt"></i></span>';
							html += '</div></div>';

							$('#room-list').append(html);
						});
					})
					.catch((error) => {
						console.log(error);
						$('#room-list').html('<i class="fas fa-exclamation-triangle"></i>');
					});

					// lấy bài học tiếp theo
					fsdb.collection("lessons").where('course_id', '==', course_id).orderBy('index', 'asc').startAfter(lesson_doc).limit(1).get()
					.then((querySnapshot) => {
						querySnapshot.forEach((doc) => {
							let docid = doc.id;
							let link = '/classroom.html?lesson=' + docid + '&slug=' + TextToSlug(doc.data().lesson);
							$('#lesson-next').html('<i class="fas fa-step-forward"></i>').attr('href', link);
						});
					})
					.catch((error) => {
						console.log(error);
					});
					// view to frame
					document.querySelector('#room-view').click();
				}
				else
				{
					console.log("No such document!");
				}
			}).catch((error) => {
				console.log(error);
			});
		}
		// load courses
		else
		{
			GetCourses();
		}

		$('[data-toggle="tooltip"]').tooltip();

		/*$('.select2').select2();*/

		// kiểm nhắc nhở chọn khóa học
		$('#room-lesson, #room-courses').on('change keyup', function ()
		{
			var course = $('#room-courses').val();
			if (!course)
			{
				$('#room-courses').addClass('is-invalid');
			}
			else
			{
				$('#room-courses').removeClass('is-invalid');
			}
		});

		$('#text-zoom').click(function ()
		{
			$('#card-content').addClass('text-lg');
		})

		document.addEventListener("selectionchange", function(event)
		{
			select_text = getSelectText();
		});
		document.addEventListener('touchend', showToolbox);
		document.addEventListener("mouseup", showToolbox);
		function showToolbox(e)
		{
			let x = e.pageX;
			let y = e.pageY;
			let elem = $("#toolbox");
			if (select_text)
			{
				elem.css('position', 'absolute');
				elem.css("left", x);
				elem.css("top", y);
				elem.show();
			}
			else
			{
				elem.hide();
			}
		}
		$("#toolbox-highlight").click(function ()
		{
			$("#toolbox").hide();
			let inner_html = $('#card-content').html();
			html_content = inner_html;
			let index = inner_html.indexOf(select_text);
			if (index >= 0 && select_text)
			{
				inner_html = inner_html.substring(0,index) + "<span class='highlight'>" + inner_html.substring(index,index+select_text.length) + "</span>" + inner_html.substring(index + select_text.length);
				$('#card-content').html(inner_html);
				$('#room-content').val(inner_html);
			}
			clearSelectText();
		});
		$('#toolbox-bold').click(function ()
		{
			$("#toolbox").hide();
			let inner_html = $('#card-content').html();
			html_content = inner_html;
			let index = inner_html.indexOf(select_text);
			if (index >= 0 && select_text)
			{
				inner_html = inner_html.substring(0,index) + "<strong>" + inner_html.substring(index,index+select_text.length) + "</strong>" + inner_html.substring(index + select_text.length);
				$('#card-content').html(inner_html);
				$('#room-content').val(inner_html);
			}
			clearSelectText();
		});
		$('#toolbox-undo').click(function ()
		{
			$("#toolbox").hide();
			if (!html_content) return;
			$('#card-content').html(html_content);
			$('#room-content').val(html_content);
		})

		// lưu bài học mới hoặc cập nhật
		$('#room-lesson-save').click(function ()
		{
			// save lesson
			$('#room-lesson-save').removeClass('text-success').removeClass('text-danger').html('<i class="fas fa-save"></i>');

			let content = $('#room-content').removeClass('is-invalid').val().trim();
			let course_id = $('#room-courses').removeClass('is-invalid').val().trim();
			let lesson = $('#room-lesson').removeClass('is-invalid').val().trim();
			if (!content)
			{
				$('#room-content').addClass('is-invalid').focus();
				return;
			}
			if (!course_id)
			{
				$('#room-courses').addClass('is-invalid').focus();
				return;
			}
			if (!lesson)
			{
				$('#room-lesson').addClass('is-invalid').focus();
				return;
			}
			$('#room-lesson-save').html('<i class="fas fa-spinner fa-spin"></i>');

			let created_at = moment().unix();

			// lưu bài học mới
			if (!lesson_index)
			{
				fsdb.collection("lessons").add({
					content: content,
					course_id: course_id,
					lesson: lesson,
					created_at: created_at
				})
				.then((docRef) => {
					console.log("lesson ID: ", docRef.id);
					lesson_index = docRef.id;
					$('#room-lesson-save').addClass('text-success').html('<i class="fas fa-check"></i>');
				})
				.catch((error) => {
					console.log(error);
					$('#room-lesson-save').removeClass('text-success').addClass('text-danger').html('<i class="fas fa-times"></i>');
				});
			}
			// cập nhật bài học hiện có
			else
			{
				fsdb.collection("lessons").doc(lesson_index).update({
					content: content,
					course_id: course_id,
					lesson: lesson
				})
				.then(() => {
					$('#room-lesson-save').addClass('text-success').html('<i class="fas fa-check"></i>');
				})
				.catch((error) => {
					console.log(error);
					$('#room-lesson-save').removeClass('text-success').addClass('text-danger').html('<i class="fas fa-times"></i>');
				});
			}
		})

		// đánh dấu bài học đã hoàn thành
		$('#room-lesson-completed').click(function ()
		{
			if (!lesson_index) return;

			fsdb.collection("lessons").doc(lesson_index).update({
				completed: true
			})
			.then(() => {
				$('#room-lesson-completed').addClass('text-success').html('<i class="fas fa-user-graduate"></i>');
			})
			.catch((error) => {
				console.log(error);
			});
		})

		// lưu kiến thức mới của bài học
		$('#room-study-save').click(function ()
		{
			let new_study = $("#room-brain").val().trim();
			if (!new_study)
			{
				let highlight = getSelectText().trim();
				$('#room-brain').val(highlight);
				clearSelectText();
				return;
			}

			let course_id = $('#room-courses').val().trim();
			
			if (!course_id)
			{
				$('#room-courses').addClass('is-invalid').focus();
				return;
			}
			if (!lesson_index)
			{
				$('#room-lesson-save').addClass('text-danger').html('<i class="far fa-hand-point-up fa-spin"></i>');
				return;
			}

			$('#room-study-save').html('<i class="fas fa-spinner fa-spin"></i>');

			let created_at = moment().unix();

			fsdb.collection("informations").add({
				course_id: course_id,
				lesson_id: lesson_index,
				created_at: created_at,
				study: new_study
			})
			.then((docRef) => {
				var html = '<div class="input-group">';
				html += '<textarea class="form-control room-brains is-valid" rows="1" data-study-id="' + docRef.id + '" onchange="StudyChange(this)">' + new_study + '</textarea>';
				html += '<div class="input-group-append">';
				html += '<span class="btn btn-danger input-group-text btn-xs" data-study-id="' + docRef.id + '" onclick="DeleteStudy(this)"><i class="fas fa-trash-alt"></i></span>';
				html += '</div></div>';

				$('#room-list').prepend(html);
				$("#room-brain").val('');
				$('#room-study-save').html('<i class="far fa-lightbulb"></i>');
			})
			.catch((error) => {
				console.log(error);
				$('#room-study-save').html('<i class="fas fa-exclamation-triangle"></i>');
			});
		});

		// sửa kích thước iframe full width height
		$('#room-content').on('change keyup', function ()
		{
			var content = $(this).val().replace(/width="(\w+.)"/, 'width="100%"').replace(/height="(\w+.)"/, 'height="100%"');
			$(this).val(content);
		})

		// ẩn thanh điều khiển 
		$('#room-view-hide').click(function ()
		{
			$('#room-content').parents('div.card-header').toggle('hide');
			$('.content-wrapper .content-header').toggle('hide');
			$('#room-lesson').parents('div.input-group').toggle('hide');

			$('.main-sidebar').toggle('hide');
			$('.main-header').toggle('hide');
		})

		// xem html sang iframe
		$('#room-view').click(function ()
		{
			var content = $('#room-content').val();
			$('#card-content').html(content);
		});

		$('#page-height-plus').click(function ()
		{
			var height = $('#card-content iframe').attr('height').replace('px', '').replace('%', '');
			height = Number(height) + 100;
			$('#card-content iframe').attr('height', height + 'px');
		})
		$('#page-height-minus').click(function ()
		{
			var height = $('#card-content iframe').attr('height').replace('px', '').replace('%', '');
			height = Number(height) - 100;
			$('#card-content iframe').attr('height', (height >= 0 ? height : '0') + 'px');
		})
		// sửa lại định dạng nội dung
		$('#room-lesson-format').click(function ()
		{
			var content = $('#room-content').val();
			// loại bỏ các thẻ span
			content = content.replace(/<span.*?>/g, '').replace(/<\/span>/g, '');
			// loại bỏ ký tự cách
			content = content.replace(/&nbsp;/g, ' ');
			// rút gọn các thẻ div
			content = content.replace(/<div.*?>/g, '<div>');
			// loại bỏ các class, alt, title
			content = content.replace(/class=".*?"/g, '').replace(/alt=".*?"/g, '').replace(/title=".*?"/g, '');
			// rút gọn các thẻ p
			content = content.replace(/<p.*?>/g, '<p>');
			content = content.replace(/<a.*?>/g, '<a>');
			content = content.replace(/<div.*?>/g, '<div>');
			content = content.replace(/<span.*?>/g, '<span>');
			content = content.replace(/<h1.*?>/g, '<h1>');
			content = content.replace(/<h2.*?>/g, '<h2>');
			content = content.replace(/<h3.*?>/g, '<h3>');
			content = content.replace(/<h4.*?>/g, '<h4>');
			content = content.replace(/<h5.*?>/g, '<h5>');
			// rút gọn các thẻ thừa
			content = content.replace(/<\w+><\/\w+>/g, '');
			// rút gọn các khoản trống
			content = content.replace(/>\s+</g, '><');
			// loại bỏ nhiều khoảng trắng
			content = content.replace(/\s+/g, ' ').replace(/\s+>/g, '>').replace(/>\s+/g, '>');

			$('#room-content').val(content);
			$('#card-content').html(content);
		})
		// set chiều dài iframe
		function SetFrameHeight(number)
		{
			var height = Number(number);
			$('#card-content iframe').attr('height', height + 'px');
		}
		// cập nhật nội dung kiến thức đã có
		function StudyChange(element)
		{
			$(element).removeClass('is-valid').removeClass('is-invalid');
			let study_index = $(element).data('study-id');
			let new_study = $(element).val().trim();

			fsdb.collection("informations").doc(study_index).update({
				study: new_study
			})
			.then(() => {
				$(element).addClass('is-valid');
			})
			.catch((error) => {
				console.log(error);
				$(element).addClass('is-invalid');
			});
		}

		// lấy danh sách khóa học
		function GetCourses(course_id)
		{
			fsdb.collection("courses").orderBy("created_at", "desc").get()
			.then((querySnapshot) => {
				var options = '<option value=""> -- Khóa Học -- </option>';
				querySnapshot.forEach((doc) => {
					let docid = doc.id;
					let docdata = doc.data();
					let choose = '';
					if (docid == course_id) {
						choose = 'selected';
					}
					options += '<option value="' + docid + '" ' + choose + '>' + docdata.course + '</option>';
				});
				$('#room-courses').html(options);
			})
			.catch((error) => {
				console.log(error);
			});
		}

		// xóa 1 ghi chép
		function DeleteStudy(element)
		{
			if (!confirm('Xóa ghi chép?'))
			{
				return;
			}
			var study_id = $(element).data('study-id');

			fsdb.collection("informations").doc(study_id).delete().then(() => {
				$(element).parents('div.input-group').remove();
			}).catch((error) => {
				console.log(error);
			});
		}
	</script>
</body>
</html>